<full worker.js content omitted here for brevity>